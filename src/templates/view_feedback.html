{% extends "layouts/base.html" %}

{% block head %}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script type="text/javascript" src="/js/admin/view_feedback.js"></script>
{{ super() }}
{% endblock head %}

{% block content %}
    {{ super() }}
    <div class="container" id='pageContent'>
        <div class="card feedback-filters">
            <div class="card-body">
                <label>Show:</label>
                <select class="form-control" id="show-select">
                    <option value="Active" selected>Active Tickets</option>
                    <option value="Archived">Archived Tickets</option>
                </select>
                <label>Filter By Tag:</label>
                <select class="form-control" id="tag-select">
                    <option value="DEFAULT" selected>Feedback with any tag(s)</option>
                    <option value="Profile">Profile</option>
                    <option value="Viewing Questions">Viewing Questions</option>
                    <option value="Posting Responses">Posting Responses</option>
                    <option value="Viewing Responses">Viewing Responses</option>
                    <option value="Adding Students">Adding Students</option>
                    <option value="Adding Assignments">Adding Assignments</option>
                    <option value="Adding Courses">Adding Courses</option>
                    <option value="Adding Rounds">Adding Rounds</option>
                    <option value="Other">Other</option>
                </select>
                <label>Filter By Ticket Status:</label>
                <select class="form-control" id="status-select">
                    <option value="DEFAULT" selected>Feedback with any status</option>
                    <option value="OPEN">Open</option>
                    <option value="IN PROGRESS">In Progress</option>
                    <option value="CLOSED">Closed</option>
                </select>
            </div>
        </div>
        {% set cardID = 1 %}
        {% for fb in feedback %}
            <div class="card" id="card{{ cardID }}" value="{{ fb.other_selected }}">
                <div class="card-title feedback-{% if fb.ticket_status == "OPEN" %}open{% elif fb.ticket_status == "IN PROGRESS" %}in-progress{% elif fb.ticket_status == "CLOSED" %}closed{% endif %}" id="cardTitle{{ cardID}}" value="{{ fb.key.id() }}">
                    <div class="row">
                        <div class="col-sm-6 col-xs-8">
                            <h4>
                                Timestamp: {{ fb.timestamp.strftime('%x %H:%M') }}
                            </h4>
                        </div>
                        <div class="col-sm-6 col-xs-4 text-right">
                            <h4 id="status{{ cardID }}" value="{{ fb.ticket_status }}">
                                {{ fb.ticket_status }}
                            </h4>
                        </div>
                    </div>
                </div>
                 <div class="card-body" id="cardBody{{ cardID }}" value="{{ fb.tags }}">
                     <div class="row">
                        <div class="col-md-9 col-sm-6">
                     <table class="table feedback-table">
                        <tr>
                            <td><strong>Submitted by</strong></td>
                            <td>{{ fb.email }}</td>
                        </tr>
                        <tr>
                            <td><strong>Tags</strong></td>
                            <td>
                                {% for str in fb.tags %}
                                    {{ str }}{% if loop.index < (fb.tags|length) %}, {% endif %}
                                {% endfor %}
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <strong>Feedback</strong>
                            </td>
                            <td>{{ fb.feedback }}</td>
                        </tr>
                     </table>
                        </div>
                     <div class="col-md-3 col-sm-6">
                     <div class="btn-group-vertical">
                         {% if fb.is_archived %}
                         <button class="btn btn-danger" type="button" id="delete{{ cardID }}" onclick="deleteTicket( {{ cardID }} )">Delete</button>
                         <button class="btn btn-default" type="button" id="reactivate{{ cardID }}" onclick="reactivateTicket( {{ cardID }} )">Reactivate</button>
                         {% else %}
                         <button class="btn btn-success" type="button" id="markOpen{{ cardID }}" onclick="markOpen( {{ cardID }} )">Mark as Open</button>
                         <button class="btn btn-warning" type="button" id="markIP{{ cardID }}" onclick="markInProgress( {{ cardID }} )">Mark as In Progress</button>
                         <button class="btn btn-danger" type="button" id="markClosed{{ cardID }}" onclick="markClosed( {{ cardID }} )">Mark as Closed</button>
                         <button class="btn btn-primary" type="button" id="archive{{ cardID }}" onclick="archiveTicket( {{ cardID }} )">Archive</button>
                     {% endif %}
                     </div>
                     </div>
                     </div>
                 </div>
            </div>
        {% set cardID = cardID+1 %}
        {% endfor %}
    </div>
{% endblock content %}